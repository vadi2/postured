app-id: io.github.vadi2.postured
runtime: org.kde.Platform
runtime-version: '6.10'
sdk: org.kde.Sdk
base: com.riverbankcomputing.PyQt.BaseApp
base-version: '6.10'
command: postured

cleanup-commands:
  - /app/cleanup-BaseApp.sh

build-options:
  env:
    - BASEAPP_REMOVE_WEBENGINE=1

finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --device=all
  - --own-name=io.github.vadi2.postured
  - --talk-name=org.kde.StatusNotifierWatcher
  - --talk-name=org.freedesktop.ScreenSaver
  - --talk-name=org.gnome.ScreenSaver
  - --talk-name=org.freedesktop.login1

modules:
  # Python dependencies
  - python3-dependencies.json

  # Layer-shell-qt library (not in KDE runtime)
  - name: layer-shell-qt
    buildsystem: cmake-ninja
    config-opts:
      - -DBUILD_TESTING=OFF
    sources:
      - type: archive
        url: https://download.kde.org/stable/plasma/6.5.5/layer-shell-qt-6.5.5.tar.xz
        sha256: 6844fee55b8b7cbc320cd8308b51595ef830d5a99b4d355b0fd59f88feab2c11

  # Layer-shell helper (Qt6 C++)
  - name: postured-layer-shell-helper
    buildsystem: cmake-ninja
    sources:
      - type: dir
        path: ../layer-shell-helper

  # Main application
  - name: postured
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app --no-deps --no-build-isolation .
      # Install desktop file with app ID name
      - install -Dm644 postured/resources/postured.desktop /app/share/applications/io.github.vadi2.postured.desktop
      - sed -i 's/Icon=postured/Icon=io.github.vadi2.postured/' /app/share/applications/io.github.vadi2.postured.desktop
      # Install icons with app ID name
      - install -Dm644 postured/resources/icons/postured.svg /app/share/icons/hicolor/scalable/apps/io.github.vadi2.postured.svg
      - for size in 16 22 24 32 48 64 128 256 512; do install -Dm644 postured/resources/icons/postured-$size.png /app/share/icons/hicolor/${size}x${size}/apps/io.github.vadi2.postured.png; done
      # Install metainfo
      - install -Dm644 flatpak/io.github.vadi2.postured.metainfo.xml /app/share/metainfo/io.github.vadi2.postured.metainfo.xml
      # Install license
      - install -Dm644 LICENSE /app/share/licenses/io.github.vadi2.postured/LICENSE
    sources:
      - type: dir
        path: ..
